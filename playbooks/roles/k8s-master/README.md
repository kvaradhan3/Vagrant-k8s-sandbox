Role Name
=========

This role Provides for the configuration of a centos 7 host to become a
kubernetes master.  It depends on some preconfiguration steps steup in
the common role.  This dependency is captured through the ansible-galaxy
meta file.

Kubernetes will require that the server have a minumum of 2 cores (4 is
better), and about 32G or RAM.

Requirements
------------

None.  While this whole setup of roles is built around the creation of
vagrant VMs, there is no requirement on vagrant as such.  The servers.yaml
file in `"{{ playbook_dir }}"` should reflect the accurate inventory.

Role Variables
--------------
The user needs to provide these variables in `k8s-master/vars/main.yml`
if they intend to use contrail as their CNI  prior to using them:

```
hub_userid:         "unspecified"
hub_password:       'unspecified'
hub_email:          'unspecified'

CONTRAIL_REPO:      'hub.juniper.net/contrail'
CONTRAIL_RELEASE:   '5.0.2-0.360'
```
A contrail PLM or TME can provide valid crendentials to use here, or
one can use an open credential on hub.docker.com as well.

The user can optionally pass in their desired cni through the command
line, using ansible's `--extra-vars` option.  That is used in the
k8s-master role.

Dependencies
------------

4 roles are created, k8s-common, which satisfies dependencies and provides
baseline variables for k8s-master and k8s-minions, and a k8s-gateway role.

Example Playbook
----------------

A typical playbook for this setup is below:
```
---
- hosts: all
  gather_facts: yes
  
- hosts:        master
  become:           true
  become_user:      root
  become_method:    sudo
  roles:
    - k8s-master

- hosts:        minions
  become:           true
  become_user:      root
  become_method:    sudo
  roles:
    - k8s-minions

- hosts:        gateway
  become:           true
  become_user:      root
  become_method:    sudo
  roles:
    - k8s-gateway
```
The definitions are driven through the server inventory in
servers.yaml.  The dependency on vagrant is that vagrant crunches the
servers.yaml to create the VMs, and leaves behind
`"{{ playbook_dir }}/.vagrant/provisioners/ansible/inventory/vagrant_ansible_inventory"`
shown below, that is used to drive the kubernetes.yaml file.
```
# Generated by Vagrant

k8s-node-01 ansible_host=127.0.0.1 ansible_port=2203 ansible_user='vagrant' ansible_ssh_private_key_file='/root/projects/Vagrant-k8s-sandbox/.vagrant/machines/k8s-node-01/virtualbox/private_key'
k8s-gateway ansible_host=127.0.0.1 ansible_port=2202 ansible_user='vagrant' ansible_ssh_private_key_file='/root/projects/Vagrant-k8s-sandbox/.vagrant/machines/k8s-gateway/virtualbox/private_key'
k8s-master ansible_host=127.0.0.1 ansible_port=2201 ansible_user='vagrant' ansible_ssh_private_key_file='/root/projects/Vagrant-k8s-sandbox/.vagrant/machines/k8s-master/virtualbox/private_key'
k8s-node-02 ansible_host=127.0.0.1 ansible_port=2204 ansible_user='vagrant' ansible_ssh_private_key_file='/root/projects/Vagrant-k8s-sandbox/.vagrant/machines/k8s-node-02/virtualbox/private_key'

[master]
k8s-master

[gateway]
k8s-gateway

[minions]
k8s-node-01
k8s-node-02
```

The syntax of `"{{ playbook_dir }}/servers.yaml"` is described in the
README.md in that directory.

A standard invocation of this playbook is:

```
ansible-playbook -i .vagrant/provisioners/ansible/inventory/vagrant_ansible_inventory -e cni=contrail all
```

License
-------

BSD

Author Information
------------------

Kannan Varadhan
kannan@ieee.org
