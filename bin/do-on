#! /bin/sh

MASTER=$(servers | awk '{print $1}')
NODES=$(servers | cut -d' ' -f2-)

if [ "x$#" = 'x0' ] ; then
    set all
fi

case $1 in
all)            HOSTS="$MASTER $NODES"  ;   shift ;;
master)         HOSTS=$MASTER           ;   shift ;;
nodes|minions)  HOSTS=$NODES            ;   shift ;;
*)              HOSTS="$1"              ;   shift ;;
esac

case $# in
0)  echo $HOSTS ;;
*)  for i in $HOSTS ; do
        echo "+ on $i: $@"
        ssh root@$i "$@"
    done
    ;;
esac
